____________________DepartamentManager.cs____________________


using Microsoft.Office.Interop.Excel;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace KursWork
{
    public class DepartamentManager
    {
        public DepartamentManager(Workbook ObjWorkBook)
        {
            Departaments = new List<Departament>();
            this.ObjWorkBook = ObjWorkBook;
        }
        public List<Departament> Departaments { get; set; }
        Workbook ObjWorkBook;
        public void Load()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            for (int i = 5; i < 9; i++)
            {
                Departament departament = new Departament();
                Range range = ObjWorkSheet.get_Range("L" + i.ToString());
                departament.Name = range.Text;
                range = ObjWorkSheet.get_Range("Q" + i.ToString());
                departament.MaxCount = Convert.ToInt32(range.Value);
                Departaments.Add(departament);
            }
        }

        public void Save()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            for (int i = 5; i < 9; i++)
            {
                Departament departament = this.Departaments[i - 5];
                Range range = ObjWorkSheet.get_Range("L" + i.ToString());
                range.Value = departament.Name;
                Range range2 = ObjWorkSheet.get_Range("Q" + i.ToString());
                range2.Value = departament.MaxCount;
            }
            ObjWorkBook.Save();
        }

    }
}



____________________Department.cs____________________


using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace KursWork
{
    class Department
    {
    }
}



____________________EmployesManager.cs____________________


using Microsoft.Office.Interop.Excel;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace KursWork
{
    public class EmployesManager
    {
        public EmployesManager(Workbook ObjWorkBook)
        {
            this.ObjWorkBook = ObjWorkBook;
            Employees = new List<Employee>();
        }
        Workbook ObjWorkBook;
        public List<Employee> Employees { get; set; }
        public void Load()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            for (int i = 5; i < 18; i++)
            {
                Employee employee = new Employee();
                Range range = ObjWorkSheet.get_Range("C" + i.ToString());
                employee.Name = range.Text;
                range = ObjWorkSheet.get_Range("D" + i.ToString());
                employee.Sex = range.Text[0];
                Employees.Add(employee);
            }
        }

        public void Save()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            for (int i = 5; i < 18; i++)
            {
                Employee employee = this.Employees[i - 5];
                Range range = ObjWorkSheet.get_Range("C" + i.ToString());
                range.Value = employee.Name;
                Range range2 = ObjWorkSheet.get_Range("D" + i.ToString());
                range2.Value = employee.Sex.ToString();
            }
            ObjWorkBook.Save();
        }

        public void setDeps(DepartamentManager departamentManager)
        {
            for (int i = 0; i < 5; i++)
            {
                Employees[i].Departament = departamentManager.Departaments[0];
            }
            for (int i = 5; i < 9; i++)
            {
                Employees[i].Departament = departamentManager.Departaments[1];
            }
            for (int i = 9; i < 11; i++)
            {
                Employees[i].Departament = departamentManager.Departaments[2];
            }
            for (int i = 11; i < 13; i++)
            {
                Employees[i].Departament = departamentManager.Departaments[3];
            }
        }

    }      
}



____________________Form2.cs____________________


using Microsoft.Office.Interop.Excel;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace KursWork
{
    public partial class Form2 : Form
    {
        DepartamentManager DepartamentManager;
        TimesManager TimesManager;
        EmployesManager EmployesManager;
        PlanManager PlanManager;
        Workbook ObjWorkBook;
        Microsoft.Office.Interop.Excel.Application ObjExcel;

        public Form2()
        {
            InitializeComponent();
            try
            {
                ObjExcel = new Microsoft.Office.Interop.Excel.Application();
                ObjWorkBook = ObjExcel.Workbooks.Open(@"C:\Users\belov\Desktop\SUAI_5sem\Applied_Optimization_Models\Lab_Lichuha\KursWork\KursWork2.xlsm", 0, false, 5, "", "", false, XlPlatform.xlWindows, "", true, false, 0, true, false, false);
            } catch (Exception e)
            {
                MessageBox.Show(e.Message);
            }
            DepartamentManager = new DepartamentManager(ObjWorkBook);
            TimesManager = new TimesManager(ObjWorkBook);
            EmployesManager = new EmployesManager(ObjWorkBook);
            PlanManager = new PlanManager(ObjWorkBook, EmployesManager, TimesManager, DepartamentManager);       
        }

        ~Form2()
        {
            ObjWorkBook.Close(0);
            ObjExcel.Quit();
        }

        public void Refresh()
        {
            DepartamentManager.Departaments.Clear();
            TimesManager.Times.Clear();
            EmployesManager.Employees.Clear();
            PlanManager.Clear();

            dgvMF.DataSource = null;
            dgvDeps.DataSource = null;
            dgvEmployee.DataSource = null;
            dgvPlan.DataSource = null;
            dgvPlanInfo.DataSource = null;
            dgvPoints.DataSource = null;


            DepartamentManager.Load();
            dgvDeps.DataSource = DepartamentManager.Departaments;

            TimesManager.Load();
            dgvPoints.DataSource = TimesManager.Times;

            EmployesManager.Load();
            EmployesManager.setDeps(DepartamentManager);
            dgvEmployee.DataSource = EmployesManager.Employees;

            PlanManager.Load();
            dgvPlan.DataSource = PlanManager.Plans;

            dgvPlanInfo.DataSource = PlanManager.PlanDeps;
            for (int i = 0; i < TimesManager.Times.Count; i++)
            {
                dgvPlanInfo.Columns[i + 2].HeaderText = TimesManager.Times[i].Period;
            }
            dgvMF.DataSource = PlanManager.PlanMFs;

            lblDeltaMF.Text = "Коэффициент: " + PlanManager.DeltaMF.ToString();
            lblResult.Text = "Количество итоговых баллов: " + PlanManager.Result.ToString();

            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            Range range = ObjWorkSheet.get_Range("A50");
            range.Value = PlanManager.Result;
            ObjWorkBook.Save();
        }
        private void Form2_Load(object sender, EventArgs e)
        {
            Refresh();
        }

        private void dgvEmployee_CellEndEdit(object sender, DataGridViewCellEventArgs e)
        {
            char value = Convert.ToChar(dgvEmployee.Rows[e.RowIndex].Cells[e.ColumnIndex].Value);
            if (value != 'м' && value != 'ж')
            {
                MessageBox.Show("Выберите м или ж, данные не сохранены");
                return;
            }
            EmployesManager.Save();
            Refresh();
        }

        private void dgvPoints_CellEndEdit(object sender, DataGridViewCellEventArgs e)
        {
            TimesManager.Save();
            Refresh();
        }

        private void dgvDeps_CellEndEdit(object sender, DataGridViewCellEventArgs e)
        {
            double value = Convert.ToInt32(dgvDeps.Rows[e.RowIndex].Cells[e.ColumnIndex].Value);
            if (value <= 0)
            {
                MessageBox.Show("Отрицательное число, данные не сохранены");
                return;
            }
            DepartamentManager.Save();
            Refresh();
            
        }

        private void dgvPlan_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            var senderGrid = (DataGridView)sender;

            if (e.ColumnIndex == 2)
            {
                SelectForm form = new SelectForm(ObjWorkBook);
                form.ShowDialog();
                Plan item = (Plan)senderGrid.Rows[e.RowIndex].DataBoundItem;
                item.Time = TimesManager.Times.Where(x => x.Period == form.Result).First();
                dgvPlan.Refresh();
                PlanManager.Save();
            }
            Refresh();
        }

        private void Form2_FormClosing(object sender, FormClosingEventArgs e)
        {
            ObjWorkBook.Close(0);
            ObjExcel.Quit();
        }

        private void btnSolver1_Click(object sender, EventArgs e)
        {
            ObjExcel.Run("Macros1");
            Refresh();           
        }

        private void btnSolver2_Click(object sender, EventArgs e)
        {
            ObjExcel.Run("Macros2");
            Refresh();
        }

        private void btnValidation_Click(object sender, EventArgs e)
        {
            List<string> ErrorList = new List<string>();
            lblError.Text = string.Empty;
            for (int i = 0; i < TimesManager.Times.Count(); i++) {
                if ((PlanManager.Plans.Where(x => x.TimePeriod == TimesManager.Times[i].Period).Count())<2){
                    ErrorList.Add("В " + TimesManager.Times[i].Period + " обедает только один сотрудник\n");
                }
            }
            foreach(var item in PlanManager.PlanDeps)
            {
                foreach(var count in item.Counts)
                {
                    if(count > item.DepMax)
                    {
                        ErrorList.Add("В отделе " + item.DepName + " на обед одновременно уходит слишком много сотрудников\n");
                    }
                }
            }
            if(ErrorList.Any())
            {
                foreach(var item in ErrorList) { lblError.Text += item; }
            } else
            {
                lblError.Text = "Все проверки успешно пройдены";
            }
        }

        private void dgvEmployee_DataError(object sender, DataGridViewDataErrorEventArgs e)
        {
             MessageBox.Show("Выберите м или ж, данные не сохранены");
             return;
        }

        private void dgvPoints_DataError(object sender, DataGridViewDataErrorEventArgs e)
        {
            MessageBox.Show("Некорректные данные");
            return;
        }

        private void dgvPlan_DataError(object sender, DataGridViewDataErrorEventArgs e)
        {
            MessageBox.Show("Некорректные данные");
            return;
        }

        private void dgvDeps_DataError(object sender, DataGridViewDataErrorEventArgs e)
        {
            MessageBox.Show("Некорректные данные");
            return;
        }
    }
}



____________________Form2.Designer.cs____________________



namespace KursWork
{
    partial class Form2
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.tabPage2 = new System.Windows.Forms.TabPage();
            this.lblError = new System.Windows.Forms.Label();
            this.btnValidation = new System.Windows.Forms.Button();
            this.btnSolver2 = new System.Windows.Forms.Button();
            this.btnSolver1 = new System.Windows.Forms.Button();
            this.label6 = new System.Windows.Forms.Label();
            this.label5 = new System.Windows.Forms.Label();
            this.label4 = new System.Windows.Forms.Label();
            this.lblResult = new System.Windows.Forms.Label();
            this.lblDeltaMF = new System.Windows.Forms.Label();
            this.dgvPlanInfo = new System.Windows.Forms.DataGridView();
            this.dgvMF = new System.Windows.Forms.DataGridView();
            this.dgvPlan = new System.Windows.Forms.DataGridView();
            this.tabPage1 = new System.Windows.Forms.TabPage();
            this.dgvEmployee = new System.Windows.Forms.DataGridView();
            this.label3 = new System.Windows.Forms.Label();
            this.dgvPoints = new System.Windows.Forms.DataGridView();
            this.label2 = new System.Windows.Forms.Label();
            this.dgvDeps = new System.Windows.Forms.DataGridView();
            this.label1 = new System.Windows.Forms.Label();
            this.tabControl1 = new System.Windows.Forms.TabControl();
            this.tabPage2.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.dgvPlanInfo)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvMF)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvPlan)).BeginInit();
            this.tabPage1.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.dgvEmployee)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvPoints)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvDeps)).BeginInit();
            this.tabControl1.SuspendLayout();
            this.SuspendLayout();
            // 
            // tabPage2
            // 
            this.tabPage2.Controls.Add(this.lblError);
            this.tabPage2.Controls.Add(this.btnValidation);
            this.tabPage2.Controls.Add(this.btnSolver2);
            this.tabPage2.Controls.Add(this.btnSolver1);
            this.tabPage2.Controls.Add(this.label6);
            this.tabPage2.Controls.Add(this.label5);
            this.tabPage2.Controls.Add(this.label4);
            this.tabPage2.Controls.Add(this.lblResult);
            this.tabPage2.Controls.Add(this.lblDeltaMF);
            this.tabPage2.Controls.Add(this.dgvPlanInfo);
            this.tabPage2.Controls.Add(this.dgvMF);
            this.tabPage2.Controls.Add(this.dgvPlan);
            this.tabPage2.Location = new System.Drawing.Point(4, 22);
            this.tabPage2.Margin = new System.Windows.Forms.Padding(2);
            this.tabPage2.Name = "tabPage2";
            this.tabPage2.Padding = new System.Windows.Forms.Padding(2);
            this.tabPage2.Size = new System.Drawing.Size(952, 495);
            this.tabPage2.TabIndex = 1;
            this.tabPage2.Text = "Планирование";
            this.tabPage2.UseVisualStyleBackColor = true;
            // 
            // lblError
            // 
            this.lblError.AutoSize = true;
            this.lblError.Location = new System.Drawing.Point(485, 448);
            this.lblError.Name = "lblError";
            this.lblError.Size = new System.Drawing.Size(104, 13);
            this.lblError.TabIndex = 11;
            this.lblError.Text = "Проверок не было.";
            // 
            // btnValidation
            // 
            this.btnValidation.Location = new System.Drawing.Point(485, 416);
            this.btnValidation.Name = "btnValidation";
            this.btnValidation.Size = new System.Drawing.Size(459, 23);
            this.btnValidation.TabIndex = 10;
            this.btnValidation.Text = "Проверка на ошибки";
            this.btnValidation.UseVisualStyleBackColor = true;
            this.btnValidation.Click += new System.EventHandler(this.btnValidation_Click);
            // 
            // btnSolver2
            // 
            this.btnSolver2.Location = new System.Drawing.Point(744, 201);
            this.btnSolver2.Name = "btnSolver2";
            this.btnSolver2.Size = new System.Drawing.Size(172, 23);
            this.btnSolver2.TabIndex = 9;
            this.btnSolver2.Text = "Найти оптимальное м/ж";
            this.btnSolver2.UseVisualStyleBackColor = true;
            this.btnSolver2.Click += new System.EventHandler(this.btnSolver2_Click);
            // 
            // btnSolver1
            // 
            this.btnSolver1.Location = new System.Drawing.Point(25, 416);
            this.btnSolver1.Name = "btnSolver1";
            this.btnSolver1.Size = new System.Drawing.Size(459, 23);
            this.btnSolver1.TabIndex = 8;
            this.btnSolver1.Text = "Найти оптимальное решение";
            this.btnSolver1.UseVisualStyleBackColor = true;
            this.btnSolver1.Click += new System.EventHandler(this.btnSolver1_Click);
            // 
            // label6
            // 
            this.label6.AutoSize = true;
            this.label6.Location = new System.Drawing.Point(498, 201);
            this.label6.Name = "label6";
            this.label6.Size = new System.Drawing.Size(99, 13);
            this.label6.TabIndex = 7;
            this.label6.Text = "Соотношение м/ж";
            // 
            // label5
            // 
            this.label5.AutoSize = true;
            this.label5.Location = new System.Drawing.Point(498, 16);
            this.label5.Name = "label5";
            this.label5.Size = new System.Drawing.Size(94, 13);
            this.label5.TabIndex = 6;
            this.label5.Text = "План по отделам";
            // 
            // label4
            // 
            this.label4.AutoSize = true;
            this.label4.Location = new System.Drawing.Point(22, 16);
            this.label4.Name = "label4";
            this.label4.Size = new System.Drawing.Size(33, 13);
            this.label4.TabIndex = 5;
            this.label4.Text = "План";
            // 
            // lblResult
            // 
            this.lblResult.AutoSize = true;
            this.lblResult.Font = new System.Drawing.Font("Microsoft Sans Serif", 12F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, ((byte)(204)));
            this.lblResult.Location = new System.Drawing.Point(21, 442);
            this.lblResult.Margin = new System.Windows.Forms.Padding(2, 0, 2, 0);
            this.lblResult.Name = "lblResult";
            this.lblResult.Size = new System.Drawing.Size(57, 20);
            this.lblResult.TabIndex = 4;
            this.lblResult.Text = "label4";
            // 
            // lblDeltaMF
            // 
            this.lblDeltaMF.AutoSize = true;
            this.lblDeltaMF.Location = new System.Drawing.Point(498, 364);
            this.lblDeltaMF.Margin = new System.Windows.Forms.Padding(2, 0, 2, 0);
            this.lblDeltaMF.Name = "lblDeltaMF";
            this.lblDeltaMF.Size = new System.Drawing.Size(70, 13);
            this.lblDeltaMF.TabIndex = 3;
            this.lblDeltaMF.Text = "ААААААААА";
            // 
            // dgvPlanInfo
            // 
            this.dgvPlanInfo.AutoSizeColumnsMode = System.Windows.Forms.DataGridViewAutoSizeColumnsMode.Fill;
            this.dgvPlanInfo.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dgvPlanInfo.Location = new System.Drawing.Point(501, 37);
            this.dgvPlanInfo.Margin = new System.Windows.Forms.Padding(2);
            this.dgvPlanInfo.Name = "dgvPlanInfo";
            this.dgvPlanInfo.RowHeadersWidth = 51;
            this.dgvPlanInfo.RowTemplate.Height = 24;
            this.dgvPlanInfo.Size = new System.Drawing.Size(415, 145);
            this.dgvPlanInfo.TabIndex = 2;
            // 
            // dgvMF
            // 
            this.dgvMF.AutoSizeColumnsMode = System.Windows.Forms.DataGridViewAutoSizeColumnsMode.Fill;
            this.dgvMF.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dgvMF.Location = new System.Drawing.Point(501, 229);
            this.dgvMF.Margin = new System.Windows.Forms.Padding(2);
            this.dgvMF.Name = "dgvMF";
            this.dgvMF.RowHeadersWidth = 51;
            this.dgvMF.RowTemplate.Height = 24;
            this.dgvMF.Size = new System.Drawing.Size(415, 122);
            this.dgvMF.TabIndex = 1;
            // 
            // dgvPlan
            // 
            this.dgvPlan.AutoSizeColumnsMode = System.Windows.Forms.DataGridViewAutoSizeColumnsMode.Fill;
            this.dgvPlan.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dgvPlan.Location = new System.Drawing.Point(25, 37);
            this.dgvPlan.Margin = new System.Windows.Forms.Padding(2);
            this.dgvPlan.Name = "dgvPlan";
            this.dgvPlan.RowHeadersWidth = 51;
            this.dgvPlan.RowTemplate.Height = 24;
            this.dgvPlan.Size = new System.Drawing.Size(459, 340);
            this.dgvPlan.TabIndex = 0;
            this.dgvPlan.CellContentClick += new System.Windows.Forms.DataGridViewCellEventHandler(this.dgvPlan_CellContentClick);
            this.dgvPlan.DataError += new System.Windows.Forms.DataGridViewDataErrorEventHandler(this.dgvPlan_DataError);
            // 
            // tabPage1
            // 
            this.tabPage1.Controls.Add(this.dgvEmployee);
            this.tabPage1.Controls.Add(this.label3);
            this.tabPage1.Controls.Add(this.dgvPoints);
            this.tabPage1.Controls.Add(this.label2);
            this.tabPage1.Controls.Add(this.dgvDeps);
            this.tabPage1.Controls.Add(this.label1);
            this.tabPage1.Location = new System.Drawing.Point(4, 22);
            this.tabPage1.Margin = new System.Windows.Forms.Padding(2);
            this.tabPage1.Name = "tabPage1";
            this.tabPage1.Size = new System.Drawing.Size(952, 495);
            this.tabPage1.TabIndex = 2;
            this.tabPage1.Text = "Входные данные";
            this.tabPage1.UseVisualStyleBackColor = true;
            // 
            // dgvEmployee
            // 
            this.dgvEmployee.AutoSizeColumnsMode = System.Windows.Forms.DataGridViewAutoSizeColumnsMode.Fill;
            this.dgvEmployee.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dgvEmployee.Location = new System.Drawing.Point(431, 59);
            this.dgvEmployee.Margin = new System.Windows.Forms.Padding(2);
            this.dgvEmployee.Name = "dgvEmployee";
            this.dgvEmployee.RowHeadersWidth = 51;
            this.dgvEmployee.RowTemplate.Height = 24;
            this.dgvEmployee.Size = new System.Drawing.Size(346, 339);
            this.dgvEmployee.TabIndex = 5;
            this.dgvEmployee.CellEndEdit += new System.Windows.Forms.DataGridViewCellEventHandler(this.dgvEmployee_CellEndEdit);
            this.dgvEmployee.DataError += new System.Windows.Forms.DataGridViewDataErrorEventHandler(this.dgvEmployee_DataError);
            // 
            // label3
            // 
            this.label3.AutoSize = true;
            this.label3.Location = new System.Drawing.Point(428, 44);
            this.label3.Margin = new System.Windows.Forms.Padding(2, 0, 2, 0);
            this.label3.Name = "label3";
            this.label3.Size = new System.Drawing.Size(66, 13);
            this.label3.TabIndex = 4;
            this.label3.Text = "Cотрудники";
            // 
            // dgvPoints
            // 
            this.dgvPoints.AutoSizeColumnsMode = System.Windows.Forms.DataGridViewAutoSizeColumnsMode.Fill;
            this.dgvPoints.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dgvPoints.Location = new System.Drawing.Point(127, 282);
            this.dgvPoints.Margin = new System.Windows.Forms.Padding(2);
            this.dgvPoints.Name = "dgvPoints";
            this.dgvPoints.RowHeadersWidth = 51;
            this.dgvPoints.RowTemplate.Height = 24;
            this.dgvPoints.Size = new System.Drawing.Size(289, 116);
            this.dgvPoints.TabIndex = 3;
            this.dgvPoints.CellEndEdit += new System.Windows.Forms.DataGridViewCellEventHandler(this.dgvPoints_CellEndEdit);
            this.dgvPoints.DataError += new System.Windows.Forms.DataGridViewDataErrorEventHandler(this.dgvPoints_DataError);
            // 
            // label2
            // 
            this.label2.AutoSize = true;
            this.label2.Location = new System.Drawing.Point(124, 267);
            this.label2.Margin = new System.Windows.Forms.Padding(2, 0, 2, 0);
            this.label2.Name = "label2";
            this.label2.Size = new System.Drawing.Size(94, 13);
            this.label2.TabIndex = 2;
            this.label2.Text = "Баллы комфорта";
            // 
            // dgvDeps
            // 
            this.dgvDeps.AutoSizeColumnsMode = System.Windows.Forms.DataGridViewAutoSizeColumnsMode.Fill;
            this.dgvDeps.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
            this.dgvDeps.Location = new System.Drawing.Point(127, 59);
            this.dgvDeps.Margin = new System.Windows.Forms.Padding(2);
            this.dgvDeps.Name = "dgvDeps";
            this.dgvDeps.RowHeadersWidth = 51;
            this.dgvDeps.RowTemplate.Height = 24;
            this.dgvDeps.Size = new System.Drawing.Size(289, 184);
            this.dgvDeps.TabIndex = 1;
            this.dgvDeps.CellEndEdit += new System.Windows.Forms.DataGridViewCellEventHandler(this.dgvDeps_CellEndEdit);
            this.dgvDeps.DataError += new System.Windows.Forms.DataGridViewDataErrorEventHandler(this.dgvDeps_DataError);
            // 
            // label1
            // 
            this.label1.AutoSize = true;
            this.label1.Location = new System.Drawing.Point(127, 44);
            this.label1.Margin = new System.Windows.Forms.Padding(2, 0, 2, 0);
            this.label1.Name = "label1";
            this.label1.Size = new System.Drawing.Size(46, 13);
            this.label1.TabIndex = 0;
            this.label1.Text = "Отделы";
            // 
            // tabControl1
            // 
            this.tabControl1.Controls.Add(this.tabPage1);
            this.tabControl1.Controls.Add(this.tabPage2);
            this.tabControl1.Dock = System.Windows.Forms.DockStyle.Fill;
            this.tabControl1.Location = new System.Drawing.Point(0, 0);
            this.tabControl1.Margin = new System.Windows.Forms.Padding(2);
            this.tabControl1.Name = "tabControl1";
            this.tabControl1.SelectedIndex = 0;
            this.tabControl1.Size = new System.Drawing.Size(960, 521);
            this.tabControl1.TabIndex = 0;
            // 
            // Form2
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(960, 521);
            this.Controls.Add(this.tabControl1);
            this.Margin = new System.Windows.Forms.Padding(2);
            this.Name = "Form2";
            this.Text = "СУПЕРПЛАНИРОВКАОБЕДОВ";
            this.FormClosing += new System.Windows.Forms.FormClosingEventHandler(this.Form2_FormClosing);
            this.Load += new System.EventHandler(this.Form2_Load);
            this.tabPage2.ResumeLayout(false);
            this.tabPage2.PerformLayout();
            ((System.ComponentModel.ISupportInitialize)(this.dgvPlanInfo)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvMF)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvPlan)).EndInit();
            this.tabPage1.ResumeLayout(false);
            this.tabPage1.PerformLayout();
            ((System.ComponentModel.ISupportInitialize)(this.dgvEmployee)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvPoints)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.dgvDeps)).EndInit();
            this.tabControl1.ResumeLayout(false);
            this.ResumeLayout(false);

        }

        #endregion

        private System.Windows.Forms.TabPage tabPage2;
        private System.Windows.Forms.Label lblResult;
        private System.Windows.Forms.Label lblDeltaMF;
        private System.Windows.Forms.DataGridView dgvPlanInfo;
        private System.Windows.Forms.DataGridView dgvMF;
        private System.Windows.Forms.DataGridView dgvPlan;
        private System.Windows.Forms.TabPage tabPage1;
        private System.Windows.Forms.DataGridView dgvEmployee;
        private System.Windows.Forms.Label label3;
        private System.Windows.Forms.DataGridView dgvPoints;
        private System.Windows.Forms.Label label2;
        private System.Windows.Forms.DataGridView dgvDeps;
        private System.Windows.Forms.Label label1;
        private System.Windows.Forms.TabControl tabControl1;
        private System.Windows.Forms.Label label4;
        private System.Windows.Forms.Label label5;
        private System.Windows.Forms.Label label6;
        private System.Windows.Forms.Button btnSolver1;
        private System.Windows.Forms.Button btnSolver2;
        private System.Windows.Forms.Label lblError;
        private System.Windows.Forms.Button btnValidation;
    }
}


____________________Models.cs____________________


using System.Collections.Generic;
using System.ComponentModel;

namespace KursWork
{
    public class Departament
    {
        [DisplayName("Отдел")]
        public string Name { get; set; }
        [DisplayName("Максимальное кол-во сотрудников на обеде")]
        public int MaxCount { get; set; }
    }

    public class Time
    {
        [DisplayName("Часы обеда")]
        public string Period { get; set; }
        [DisplayName("Баллы комфорта")]
        public int Points { get; set; }
    }

    public class Employee
    {
        [DisplayName("Имя")]
        public string Name { get; set; }
        [Browsable(false)]
        public Departament Departament { get; set; }
        [DisplayName("Отдел")]
        public string DepName { get { return Departament != null ? Departament.Name : string.Empty; } }
        [DisplayName("Пол")]
        public char Sex { get; set; }
    }

    public class Plan
    {
        [Browsable(false)]
        public Employee Employee { get; set; }
        [DisplayName("Сотрудник")]
        public string EmpName { get { return Employee != null ? Employee.Name : string.Empty; } }
        [Browsable(false)]
        public Departament Departament { get; set; }
        [DisplayName("Отдел")]
        public string DepName { get { return Departament != null ? Departament.Name : string.Empty; } }
        [Browsable(false)]
        public Time Time { get; set; }
        [DisplayName("Часы обеда")]
        public string TimePeriod { get { return Time != null ? Time.Period : string.Empty; } }
    }

    public class PlanDep
    {
        public PlanDep() { Counts = new List<int>(); }
        [DisplayName("Отдел")]
        public string DepName { get; set; }
        [Browsable(false)]
        public List<int> Counts { get; set; }
        [DisplayName("Ограничение")]
        public int DepMax { get; set; }
        public int Count1 { get { return Counts[0]; } }
        public int Count2 { get { return Counts[1]; } }
        public int Count3 { get { return Counts[2]; } }
    }

    public class PlanMF
    {
        [Browsable(false)]
        public Time Time { get; set; }
        [DisplayName("Часы обеда")]
        public string TimePeriod { get { return Time != null ? Time.Period : string.Empty; } }
        [DisplayName("Кол-во мужчин")]
        public int CountM { get; set; }
        [DisplayName("Кол-во женщин")]
        public int CountF { get; set; }
    }

}



____________________PlanManager.cs____________________


using Microsoft.Office.Interop.Excel;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace KursWork
{
    public class PlanManager
    {
        public PlanManager(Workbook ObjWorkBook, EmployesManager employesManager, TimesManager timesManager, DepartamentManager departamentManager)
        {
            this.DepartamentManager = departamentManager;
            this.EmployesManager = employesManager;
            this.TimesManager = timesManager;
            Plans = new List<Plan>();
            PlanDeps = new List<PlanDep>();
            PlanMFs = new List<PlanMF>();
            this.ObjWorkBook = ObjWorkBook;
        }

        Workbook ObjWorkBook;
        EmployesManager EmployesManager;
        TimesManager TimesManager;
        DepartamentManager DepartamentManager;
        public List<Plan> Plans { get; set; }
        public List<PlanDep> PlanDeps{ get; set; }
        public List<PlanMF> PlanMFs { get; set; }
        public double DeltaMF { get; set; }
        public double Result { get; set; }

        public void Load()
        {
            for(int i=0; i<EmployesManager.Employees.Count; i++)
            {
                Plans.Add(new Plan { Employee = EmployesManager.Employees[i], Departament = EmployesManager.Employees[i].Departament });
            }
            setTimes();
            createPlanDeps();
            createPlanMFs();
        }
        public void Save()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            for(int i = 5; i<18; i++)
            {
                Plan plan = this.Plans[i - 5];
                Range range1 = ObjWorkSheet.get_Range("E" + i.ToString());
                range1.Value = plan.TimePeriod == TimesManager.Times[0].Period ? 1 : 0;
                Range range2 = ObjWorkSheet.get_Range("F" + i.ToString());
                range2.Value = plan.TimePeriod == TimesManager.Times[1].Period ? 1 : 0;
                Range range3 = ObjWorkSheet.get_Range("G" + i.ToString());
                range3.Value = plan.TimePeriod == TimesManager.Times[2].Period ? 1 : 0;
            }
            ObjWorkBook.Save();
        }
        public void setTimes()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            for (int i = 0; i < this.Plans.Count; i++)
            {
                Plan plan = Plans[i];
                char c = 'E';
                for (int j = 0; j < 3; j++)
                {
                    string adres = c + (i + 5).ToString();
                    Range range = ObjWorkSheet.get_Range(adres);
                    if (range.Value != 0)
                    {
                        plan.Time = TimesManager.Times[j];
                    }
                    c++;
                }

            }

            Range rang = ObjWorkSheet.get_Range("X7");
            DeltaMF = rang.Value;

            rang = ObjWorkSheet.get_Range("E25");
            Result = rang.Value;

            ObjWorkBook.Save();
        }

        public void createPlanDeps()
        {
            for(int i=0; i<DepartamentManager.Departaments.Count; i++)
            {
                PlanDep pd = new PlanDep() { DepName = DepartamentManager.Departaments[i].Name, DepMax=DepartamentManager.Departaments[i].MaxCount };
                for(int j=0; j<TimesManager.Times.Count; j++)
                {
                    pd.Counts.Add(Plans.Where(x => x.Departament == DepartamentManager.Departaments[i]).ToList()
                        .Where(x => x.TimePeriod == TimesManager.Times[j].Period).ToList().Count);
                }
                PlanDeps.Add(pd);
            }
        }

        public void Clear()
        {
            this.PlanDeps.Clear();
            this.PlanMFs.Clear();
            this.Plans.Clear();
        }
        public void createPlanMFs()
        {
            for(int i=0; i<TimesManager.Times.Count; i++)
            {
                PlanMF mf = new PlanMF() { Time = TimesManager.Times[i] };
                mf.CountF = Plans.Where(x => x.Time == mf.Time).Where(x => x.Employee.Sex == 'ж').ToList().Count;
                mf.CountM = Plans.Where(x => x.Time == mf.Time).Where(x => x.Employee.Sex == 'м').ToList().Count;
                PlanMFs.Add(mf);
            }
        }
    }
    
    
}



____________________Program.cs____________________


using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace KursWork
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new Form2());
        }
    }
}



____________________SelectForm.cs____________________


using Microsoft.Office.Interop.Excel;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace KursWork
{
    public partial class SelectForm : Form
    {
        public SelectForm(Workbook ObjWorkBook)
        {
            InitializeComponent();
            this.ObjWorkBook = ObjWorkBook;
        }
        Workbook ObjWorkBook;
        public string Result = string.Empty;
        private void SelectForm_Load(object sender, EventArgs e)
        {
            TimesManager TimesManager = new TimesManager(ObjWorkBook);
            TimesManager.Load();
            foreach(var item in TimesManager.Times) { comboBox1.Items.Add(item.Period); }
        }

        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        {
            Result = comboBox1.Text;
        }
    }
}



____________________SelectForm.Designer.cs____________________



namespace KursWork
{
    partial class SelectForm
    {
        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.comboBox1 = new System.Windows.Forms.ComboBox();
            this.SuspendLayout();
            // 
            // comboBox1
            // 
            this.comboBox1.Dock = System.Windows.Forms.DockStyle.Top;
            this.comboBox1.FormattingEnabled = true;
            this.comboBox1.Location = new System.Drawing.Point(0, 0);
            this.comboBox1.Name = "comboBox1";
            this.comboBox1.Size = new System.Drawing.Size(244, 24);
            this.comboBox1.TabIndex = 0;
            this.comboBox1.SelectedIndexChanged += new System.EventHandler(this.comboBox1_SelectedIndexChanged);
            // 
            // SelectForm
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(8F, 16F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(244, 244);
            this.Controls.Add(this.comboBox1);
            this.Name = "SelectForm";
            this.Text = "SelectForm";
            this.Load += new System.EventHandler(this.SelectForm_Load);
            this.ResumeLayout(false);

        }

        #endregion

        private System.Windows.Forms.ComboBox comboBox1;
    }
}


____________________TimesManager.cs____________________


using Microsoft.Office.Interop.Excel;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace KursWork
{
    public class TimesManager
    {
        public TimesManager(Workbook ObjWorkBook)
        {
            Times = new List<Time>();
            this.ObjWorkBook = ObjWorkBook;
        }

        Workbook ObjWorkBook;
        public List<Time> Times { get; set; }

        public void Load()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            char c = 'C';
            for (int i = 0; i < 3; i++)
            {
                Time time = new Time();
                Range range = ObjWorkSheet.get_Range(c + "23");
                time.Period = range.Text;
                range = ObjWorkSheet.get_Range(c + "24");
                time.Points = Convert.ToInt32(range.Value);
                Times.Add(time);
                c++;
            }
        }

        public void Save()
        {
            Worksheet ObjWorkSheet = (Worksheet)ObjWorkBook.Sheets[2];
            char c = 'C';
            for (int i = 0; i < 3; i++)
            {
                Time time = this.Times[i];
                Range range = ObjWorkSheet.get_Range(c + "23");
                range.Value = time.Period;
                Range range2 = ObjWorkSheet.get_Range(c+"24");
                range2.Value = time.Points;
                c++;
            }
            ObjWorkBook.Save();
        }
    }
}



____________________.NETFramework,Version=v4.7.2.AssemblyAttributes.cs____________________


// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETFramework,Version=v4.7.2", FrameworkDisplayName = ".NET Framework 4.7.2")]



____________________.NETFramework,Version=v4.7.2.AssemblyAttributes.cs____________________


// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETFramework,Version=v4.7.2", FrameworkDisplayName = ".NET Framework 4.7.2")]



____________________AssemblyInfo.cs____________________


using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;

// General Information about an assembly is controlled through the following
// set of attributes. Change these attribute values to modify the information
// associated with an assembly.
[assembly: AssemblyTitle("KursWork")]
[assembly: AssemblyDescription("")]
[assembly: AssemblyConfiguration("")]
[assembly: AssemblyCompany("")]
[assembly: AssemblyProduct("KursWork")]
[assembly: AssemblyCopyright("Copyright ©  2021")]
[assembly: AssemblyTrademark("")]
[assembly: AssemblyCulture("")]

// Setting ComVisible to false makes the types in this assembly not visible
// to COM components.  If you need to access a type in this assembly from
// COM, set the ComVisible attribute to true on that type.
[assembly: ComVisible(false)]

// The following GUID is for the ID of the typelib if this project is exposed to COM
[assembly: Guid("6269ad16-52c7-43fe-9a2e-ace26d4b7f32")]

// Version information for an assembly consists of the following four values:
//
//      Major Version
//      Minor Version
//      Build Number
//      Revision
//
// You can specify all the values or you can default the Build and Revision Numbers
// by using the '*' as shown below:
// [assembly: AssemblyVersion("1.0.*")]
[assembly: AssemblyVersion("1.0.0.0")]
[assembly: AssemblyFileVersion("1.0.0.0")]



____________________Resources.Designer.cs____________________


//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------


namespace KursWork.Properties
{
    /// <summary>
    ///   A strongly-typed resource class, for looking up localized strings, etc.
    /// </summary>
    // This class was auto-generated by the StronglyTypedResourceBuilder
    // class via a tool like ResGen or Visual Studio.
    // To add or remove a member, edit your .ResX file then rerun ResGen
    // with the /str option, or rebuild your VS project.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "4.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal class Resources
    {

        private static global::System.Resources.ResourceManager resourceMan;

        private static global::System.Globalization.CultureInfo resourceCulture;

        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal Resources()
        {
        }

        /// <summary>
        ///   Returns the cached ResourceManager instance used by this class.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Resources.ResourceManager ResourceManager
        {
            get
            {
                if ((resourceMan == null))
                {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("KursWork.Properties.Resources", typeof(Resources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }

        /// <summary>
        ///   Overrides the current thread's CurrentUICulture property for all
        ///   resource lookups using this strongly typed resource class.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Globalization.CultureInfo Culture
        {
            get
            {
                return resourceCulture;
            }
            set
            {
                resourceCulture = value;
            }
        }
    }
}



____________________Settings.Designer.cs____________________


//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------


namespace KursWork.Properties
{
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "11.0.0.0")]
    internal sealed partial class Settings : global::System.Configuration.ApplicationSettingsBase
    {

        private static Settings defaultInstance = ((Settings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new Settings())));

        public static Settings Default
        {
            get
            {
                return defaultInstance;
            }
        }
    }
}



